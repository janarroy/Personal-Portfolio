<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Races</title>

  <link rel="stylesheet" href="styles.css?v=21"/>

  <style>
    /* ---------- scoped styles for the React widget ---------- */
    .react-wrap{ display:block; }
    .react-metrics{ display:grid; gap:14px; grid-template-columns: 1.2fr 1fr; }
    @media (max-width:900px){ .react-metrics{ grid-template-columns:1fr; } }

    .react-card{ background:#fff; border:1px solid rgba(17,19,24,.10); border-radius:16px; padding:16px; box-shadow:0 10px 30px rgba(17,19,24,.04); }

    /* metric tiles */
    .react-tiles{ display:grid; gap:10px; grid-template-columns:repeat(4, minmax(0,1fr)); }
    @media (max-width:640px){ .react-tiles{ grid-template-columns:repeat(2, minmax(0,1fr)); } }
    .react-tile{ border:1px solid rgba(0,0,0,.06); border-radius:12px; padding:12px; background:#fff; }
    .react-tile .n{ font-weight:800; font-size:22px; letter-spacing:.2px; background:linear-gradient(90deg,#1d4ed8,#06b6d4); -webkit-background-clip:text; background-clip:text; color:transparent; }
    .react-tile .l{ font-size:12px; color:#6b7280; margin-top:4px; }

    /* training bar chart */
    .react-chart-title{ font-size:13px; font-weight:700; color:#374151; margin-bottom:8px; }
    .react-bars-wrap{ border:1px solid rgba(17,19,24,.10); border-radius:12px; padding:10px; background:#fff; }
    .react-bars{ display:grid; grid-auto-flow:column; grid-auto-columns:1fr; align-items:end; height:160px; gap:10px; padding:8px 8px 2px; }
    .react-bar{ position:relative; background:#e6f0ff; border:1px solid #c7dbff; border-radius:6px 6px 0 0; }
    .react-bar::after{ content:attr(data-miles) " mi"; position:absolute; left:50%; transform:translateX(-50%); bottom:100%; font-size:11px; color:#374151; margin-bottom:4px; white-space:nowrap; }
    .react-x{ display:grid; grid-auto-flow:column; grid-auto-columns:1fr; gap:10px; margin-top:6px; font-size:11px; color:#6b7280; text-align:center; }

    /* strava card (more content) */
    .react-strava{ display:flex; flex-direction:column; gap:12px; }
    .react-strava .row{ display:flex; align-items:center; gap:12px; }
    .react-strava .avatar{ width:48px; height:48px; border-radius:999px; overflow:hidden; background:#ffe5d6; display:grid; place-items:center; font-weight:800; color:#fc4c02; }
    .react-strava .avatar img{ width:100%; height:100%; object-fit:cover; display:block; }
    .react-strava .btn{ display:inline-flex; align-items:center; gap:10px; padding:10px 14px; border-radius:10px; background:#fc4c02; color:#fff; border:0; font-weight:700; cursor:pointer; text-decoration:none; width:max-content; }
    .react-strava .btn:hover{ filter:brightness(.95); }
    .react-strava small{ color:#6b7280; }
    .react-mini{ display:flex; gap:6px; margin-top:6px; }
    .react-mini div{ width:14px; height:8px; border-radius:3px; background:#e5e7eb; }
    .react-mini div.on{ background:#60a5fa; }

    .strava-actions{ display:flex; gap:8px; flex-wrap:wrap; }
    .copy-btn{ border:1px solid rgba(17,19,24,.12); background:#fff; border-radius:10px; padding:8px 10px; font-size:13px; cursor:pointer; }
    .copy-btn:hover{ background:#f8fafc; }

    /* race cards */
    .react-stack{ display:grid; gap:16px; }
    .react-bar-hdr{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:10px; }
    .react-bar-hdr h2{ margin:0; font-size:18px; }
    .react-date{ color:#60646c; font-size:13px; }

    .react-grid{ display:grid; gap:16px; grid-template-columns:minmax(0,58%) minmax(0,42%); align-items:stretch; }
    @media (max-width:900px){ .react-grid{ grid-template-columns:1fr; } }
    .react-col-media{ min-width:0; }
    .react-col-notes{ min-width:0; display:flex; flex-direction:column; gap:10px; background:#fff; border:1px solid rgba(17,19,24,.10); border-radius:14px; padding:12px; }

    .react-title{ margin:0; font-size:16px; }
    .react-meta{ color:#6b7280; font-size:12px; }

    .react-stats{ display:grid; grid-template-columns:repeat(3, minmax(0,1fr)); gap:8px; }
    .react-stat{ background:#fff; border:1px solid rgba(0,0,0,.06); border-radius:10px; padding:8px; text-align:center; box-shadow:0 6px 18px rgba(0,0,0,.05); }
    .react-stat-number{ font-weight:800; letter-spacing:.2px; font-size:20px; background:linear-gradient(90deg,#1d4ed8,#06b6d4); -webkit-background-clip:text; background-clip:text; color:transparent; }
    .react-stat-label{ font-size:12px; color:#6b7280; margin-top:2px; }

    .react-tags{ display:flex; flex-wrap:wrap; gap:6px; }
    .react-tag{ font-size:12px; padding:3px 6px; border:1px solid rgba(17,19,24,.12); border-radius:999px; background:#fff; color:#374151; }

    .react-story p{ margin:8px 0; font-size:15px; line-height:1.6; color:#111318; }
    .react-goal{ display:flex; align-items:center; gap:10px; }
    .react-goalbar{ flex:1; height:8px; border-radius:999px; background:#eef2ff; overflow:hidden; border:1px solid #dbe3ff; }
    .react-goalbar > span{ display:block; height:100%; background:linear-gradient(90deg,#22c55e,#3b82f6); width:0; transition:width .6s ease; }
    .react-goal small{ color:#6b7280; }
    .react-note{ font-size:12px; color:#6b7280; }

    /* slider (no crop) */
    .react-slider{ position:relative; width:100%; border-radius:14px; overflow:hidden; background:#fff; }
    .react-slides{ display:grid; grid-auto-flow:column; grid-auto-columns:100%; transition: transform .35s ease; }
    .react-slide{ display:flex; align-items:flex-start; justify-content:center; }
    .react-media{ width:100%; height:auto; object-fit:contain; display:block; background:#fff; border-radius:14px; max-height:80vh; }
    .react-video{ background:#000; }
    .react-nav{ position:absolute; top:50%; transform:translateY(-50%); z-index:2; width:36px; height:36px; border-radius:999px; border:0; cursor:pointer; background:rgba(17,19,24,.65); color:#fff; display:grid; place-items:center; }
    .react-prev{ left:10px; } .react-next{ right:10px; }
    .react-nav:hover{ background:rgba(17,19,24,.8); }
    .react-dots{ position:absolute; left:50%; bottom:10px; transform:translateX(-50%); display:flex; gap:6px; z-index:2; }
    .react-dot{ width:8px; height:8px; border-radius:999px; border:0; background:rgba(17,19,24,.25); cursor:pointer; }
    .react-dot.on{ background:rgba(17,19,24,.6); }

    /* skyline + simple route spark (kept, small) */
    .route{ margin-top:8px; border:1px solid rgba(0,0,0,.06); border-radius:10px; padding:8px; }
    .route svg{ width:100%; height:64px; }
    .route path{ fill:none; stroke:#3b82f6; stroke-width:3; stroke-linecap:round; stroke-linejoin:round; stroke-dasharray:400; stroke-dashoffset:400; animation:draw 1.8s ease forwards; }
    @keyframes draw{ to{ stroke-dashoffset:0; } }

    /* Course map block */
    .course-map{ border:1px solid rgba(0,0,0,.06); border-radius:10px; overflow:hidden; }
    .course-map img{ width:100%; height:auto; display:block; object-fit:contain; max-height:220px; background:#fff; }
    .course-map .cm-bar{ display:flex; align-items:center; justify-content:space-between; gap:8px; padding:6px 10px; border-top:1px solid rgba(0,0,0,.06); background:#fafafa; font-size:12px; color:#374151; }
    .course-map .cm-bar a{ color:#2563eb; text-decoration:none; }
  </style>
</head>

<body class="plain-bg">
  <nav class="nav">
    <div class="container nav-inner">
      <a class="brand" href="index.html">Jan</a>
      <div class="nav-links">
        <a class="btn" href="index.html#work">Projects</a>
        <a class="btn" href="races.html">Races</a>
        <a class="btn" href="#bake">Bake</a>
        <a class="btn" href="#travel">Travel</a>
        <a class="btn" href="#contact">Contact</a>
      </div>
    </div>
  </nav>

  <main class="container work">
    <h1 class="page-title">Races</h1>
    <p class="tag">Marathons and distance events I’ve run.</p>

    <div id="races-app"></div>
  </main>

  <footer>© <span id="year"></span> Jan Arroyo — Thanks for visiting!</footer>
  <script>document.getElementById('year').textContent = new Date().getFullYear();</script>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useEffect, useRef, useState } = React;

    /* ------------ CONFIG ------------- */
    const STRAVA_ATHLETE_ID = "137523264";
    const STRAVA_AVATAR_URL = ""; // optional: drop a headshot link here

    /* ------------ DATA ------------- */
    const RACES = [
      {
        id: "sf10k-2025",
        dateISO: "2025-07-27",
        dateLabel: "July 27, 2025",
        title: "San Francisco 10K",
        city: "San Francisco",
        distance: 6.2,
        trainingMiles: 120,
        finishSeconds: 4237,           // 1:10:37
        goalSeconds: 4200,             // 1:10:00
        description: [
          "We spent the summer in San Francisco, so this felt like a hometown race for a few months. Cool air came off the bay and the city felt generous—random claps from doorways, a cyclist ringing a bell, little slices of the skyline between buildings. The plan was simple: stay together, keep the cadence easy, and enjoy the morning.",
          "We fell into pace early and tried not to chase the short hills. Around mile four the streetcars were out, coffee was in the air, and the last stretch arrived faster than I expected. We crossed side by side and started tossing out other races we want to run."
        ],
        tags: ["Course: rolling city streets, cool air", "Fuel: water + one gel pre-start", "Shoes: Hoka Clifton 9"],
        routePath: "M10,52 C40,40 60,38 90,30", // stylized spark
        courseMapImg: "images/maps/sf10k-map.jpg",
        courseMapSrc: "https://www.thesfmarathon.com/10k/",
      },
      {
        id: "surf-city-2025",
        dateISO: "2025-02-02",
        dateLabel: "February 2, 2025",
        title: "Surf City Marathon",
        city: "Huntington Beach",
        distance: 26.2,
        trainingMiles: 820,
        finishSeconds: 14304,          // 3:58:24
        goalSeconds: 14400,            // 4:00:00
        description: [
          "My first full. The start line felt like a block party—cowbells, flags, ocean wind pinning the bib to my shirt. Sub-4 sat right on the edge, so the plan was patient: relax through halfway, stay honest to twenty, then race whatever was left.",
          "PCH kept changing moods. Some miles were free, then a turn would push back. I kept the gels steady and tried to be a metronome. At mile twenty-four the math said sub-4 was still alive. The last mile was loud and shaky and perfect. I finished in 3:58:24 and let myself be proud for a minute."
        ],
        tags: ["Course: out-and-back along PCH", "Fuel: gels + electrolytes every 5–6 mi", "Shoes: Hoka Clifton 9"],
        routePath: "M10,40 C30,34 50,34 70,40 S110,48 130,44",
        courseMapImg: "images/maps/surfcity-map.jpg",
        courseMapSrc: "https://www.runsurfcity.com/marathon",
      },
      {
        id: "long-beach-2024",
        dateISO: "2024-10-06",
        dateLabel: "October 6, 2024",
        title: "Long Beach Half Marathon",
        city: "Long Beach",
        distance: 13.1,
        trainingMiles: 471,
        finishSeconds: 7152,           // 1:59:12
        goalSeconds: 7200,             // 2:00:00
        description: [
          "Emma talked me into this one and I’m glad she did. Training had gaps around school and late dinners, but race morning was calm—the ocean looked flat and silver and it felt like we had time.",
          "I kept things easy until halfway, waited out the mile-10 doubts, and then counted light poles to the finish. We slid under two hours and went straight to breakfast. That’s a good day."
        ],
        tags: ["Course: flat waterfront with a light breeze", "Fuel: gels with water at stations", "Shoes: Hoka Clifton 9"],
        routePath: "M10,50 L40,44 L70,46 L100,42 L130,46",
        courseMapImg: "images/maps/longbeach-half-map.jpg",
        courseMapSrc: "https://runlongbeach.com/events/half-marathon/",
      },
    ];

    // More realistic weekly miles
    const TRAINING = [
      { week: "2024-12-15", miles: 18 },
      { week: "2024-12-22", miles: 21 },
      { week: "2024-12-29", miles: 24 },
      { week: "2025-01-05", miles: 26 },
      { week: "2025-01-12", miles: 30 },
      { week: "2025-01-19", miles: 32 },
      { week: "2025-01-26", miles: 29 },
      { week: "2025-02-02", miles: 12 },
    ];

    /* ------------ HELPERS ------------- */
    const pad = (n)=>String(n).padStart(2,"0");
    const formatTime = (totalSeconds) => {
      const s = Math.round(totalSeconds);
      const h = Math.floor(s / 3600);
      const m = Math.floor((s % 3600) / 60);
      const r = s % 60;
      return h > 0 ? `${h}:${pad(m)}:${pad(r)}` : `${m}:${pad(r)}`;
    };
    const paceStr = (secsPerMile)=>{
      const m = Math.floor(secsPerMile/60), s = Math.round(secsPerMile%60);
      return `${m}:${pad(s)}/mi`;
    };
    const sum = (arr, key)=>arr.reduce((t,x)=>t+(typeof key==="function"?key(x):x[key]),0);
    const minBy = (arr, f)=>arr.reduce((best,x)=>f(x)<f(best)?x:best, arr[0]);

    /* ------------ bar chart ------------- */
    function MilesBarChart({ data }) {
      const max = Math.max(1, ...data.map(d=>d.miles));
      return (
        <div className="react-bars-wrap">
          <div className="react-chart-title">Weekly training miles</div>
          <div className="react-bars">
            {data.map((d,i)=>(
              <div key={i}
                   className="react-bar"
                   data-miles={d.miles}
                   style={{ height: `${(d.miles/max)*100}%` }} />
            ))}
          </div>
          <div className="react-x">
            {data.map((d,i)=> <div key={i}>{d.week.slice(5)}</div>)}
          </div>
        </div>
      );
    }

    /* ------------ slider (no crop) ------------- */
    function MediaSlider({ media }) {
      const [i, setI] = useState(0);
      const trackRef = useRef(null);
      const go = (n)=>setI(p=>(n+media.length)%media.length);

      const measure = ()=>{
        const el=trackRef.current; if(!el) return;
        const slide=el.children[i]; if(!slide) return;
        const h = slide.getBoundingClientRect().height;
        el.style.height = h ? `${h}px` : "auto";
      };
      useEffect(()=>{ requestAnimationFrame(measure); },[i, media]);
      useEffect(()=>{ const on=()=>measure(); window.addEventListener('resize',on); return ()=>window.removeEventListener('resize',on); },[]);

      return (
        <div className="react-slider">
          <div ref={trackRef} className="react-slides" style={{ transform:`translateX(-${i*100}%)` }}>
            {media.map((m,idx)=>(
              <div key={idx} className="react-slide">
                {m.type==="img" ? (
                  <img src={m.src} alt={m.alt} className="react-media"
                       loading={idx===0?"eager":"lazy"} onLoad={measure}/>
                ) : (
                  <video controls className="react-media react-video" onLoadedMetadata={measure}>
                    <source src={m.src} type="video/mp4"/>
                  </video>
                )}
              </div>
            ))}
          </div>
          <button className="react-nav react-prev" aria-label="Previous" onClick={()=>go(i-1)}>‹</button>
          <button className="react-nav react-next" aria-label="Next" onClick={()=>go(i+1)}>›</button>
          <div className="react-dots">
            {media.map((_,idx)=>(
              <button key={idx} className={("react-dot "+(idx===i?"on":""))} onClick={()=>setI(idx)} aria-label={`Go to slide ${idx+1}`}/>
            ))}
          </div>
        </div>
      );
    }

    /* ------------ small pieces ------------- */
    function StatTile({ label, value, isTime=false }) {
      return (
        <div className="react-stat">
          <div className="react-stat-number">{isTime ? formatTime(value) : value}</div>
          <div className="react-stat-label">{label}</div>
        </div>
      );
    }

    function TagRow({ tags }){
      return (
        <div className="react-tags">
          {tags.map((t,i)=><span className="react-tag" key={i}>{t}</span>)}
        </div>
      );
    }

    function GoalMeter({ finishSeconds, goalSeconds }){
      const pctRaw = goalSeconds ? (finishSeconds/goalSeconds)*100 : 0;
      const pct = Math.min(100, Math.max(0, pctRaw));
      const delta = finishSeconds - goalSeconds;
      const sign = delta <= 0 ? "faster" : "slower";
      const abs = Math.abs(delta);
      return (
        <div className="react-goal">
          <div className="react-goalbar" aria-hidden="true">
            <span style={{ width: `${pct}%` }}></span>
          </div>
          <small>{formatTime(finishSeconds)} vs goal {formatTime(goalSeconds)} · {formatTime(abs)} {sign}</small>
        </div>
      );
    }

    function RouteSpark({ d }){
      return (
        <div className="route" title="Stylized route">
          <svg viewBox="0 0 140 64" preserveAspectRatio="none">
            <path d={d}/>
          </svg>
        </div>
      );
    }

    function CourseMap({ img, src }){
      const hasImg = !!img;
      return (
        <div className="course-map" title="Course map">
          {hasImg ? (
            <img src={img} alt="Official course map"/>
          ) : (
            <div style={{padding:"16px", fontSize:"14px", color:"#374151"}}>Map image not added yet.</div>
          )}
          <div className="cm-bar">
            <span>Course map</span>
            <a href={src} target="_blank" rel="noreferrer">View official source</a>
          </div>
        </div>
      );
    }

    /* ------------ race card ------------- */
    function RaceCard({ race }) {
      const pace = race.finishSeconds / race.distance;
      return (
        <section className="react-card">
          <div className="react-bar-hdr">
            <h2>{race.title}</h2>
            <span className="react-date">{race.dateLabel}</span>
          </div>

          <div className="react-grid">
            <div className="react-col-media">
              <MediaSlider media={race.media} />
            </div>

            <div className="react-col-notes">
              <h3 className="react-title">{race.title}</h3>
              <div className="react-meta">{race.city} · {race.distance} miles</div>

              <div className="react-stats">
                <StatTile label="training miles" value={race.trainingMiles} />
                <StatTile label="finish" value={race.finishSeconds} isTime />
                <StatTile label="avg pace" value={paceStr(pace)} />
              </div>

              <TagRow tags={race.tags} />
              {race.goalSeconds && <GoalMeter finishSeconds={race.finishSeconds} goalSeconds={race.goalSeconds} />}

              <RouteSpark d={race.routePath}/>
              <CourseMap img={race.courseMapImg} src={race.courseMapSrc}/>

              <div className="react-story">
                {race.description.map((p,i)=><p key={i}>{p}</p>)}
              </div>

              <div className="react-note">Photos and videos show full size. No cropping.</div>
            </div>
          </div>
        </section>
      );
    }

    /* ------------ strava follow ------------- */
    function StravaCard(){
      const url = STRAVA_ATHLETE_ID ? `https://www.strava.com/athletes/${STRAVA_ATHLETE_ID}` : "#";
      const totalsYTD = sum(TRAINING.filter(d=>d.week.startsWith("2025")), "miles");
      const recent4 = TRAINING.slice(-4).map(d=>d.miles);
      const max4 = Math.max(1, ...recent4);
      const initials = "JA";
      const copy = async () => {
        try { await navigator.clipboard.writeText(url); alert("Strava link copied!"); } catch(e) {}
      };
      return (
        <div className="react-card react-strava">
          <div style={{fontSize:13, fontWeight:700, color:"#374151"}}>Follow me on Strava</div>
          <div className="row">
            <div className="avatar">
              {STRAVA_AVATAR_URL
                ? <img src={STRAVA_AVATAR_URL} alt="avatar"/>
                : <span>{initials}</span>}
            </div>
            <div>
              <div className="strava-actions">
                <a className="btn" href={url} target="_blank" rel="noreferrer">
                  <svg width="18" height="18" viewBox="0 0 48 48" aria-hidden="true"><path fill="#fff" d="M27.7 27.4l6.2 10.6 6.3-10.6h-4.8L33.9 34l-3.6-6.6h-2.6zm-6.7-19L4.7 42.3h9.8l3.4-6.3h8.7l-6.5-11.5 4.4-8.2 8.1 14.5h5L21 8.4z"/></svg>
                  Follow on Strava
                </a>
                <button className="copy-btn" onClick={copy}>Copy link</button>
              </div>
              <div style={{marginTop:6, fontSize:13, color:"#374151"}}>Miles this year: <b>{totalsYTD}</b></div>
              <div className="react-mini" aria-hidden="true">
                {recent4.map((m,i)=>(
                  <div key={i} className={m>0?"on":""} style={{height: 8 + (m/max4)*12}}></div>
                ))}
              </div>
            </div>
          </div>
          <small>Training logs live there. Routes and races show up when I remember to hit upload.</small>
        </div>
      );
    }

    /* ------------ top area ------------- */
    function TopBlock(){
      const total2025 = sum(TRAINING.filter(d=>d.week.startsWith("2025")), "miles");
      const races2025 = RACES.filter(r=>r.dateISO.startsWith("2025")).length;
      const raceMilesAll = sum(RACES, "distance");
      const fastest = minBy(RACES, r => r.finishSeconds/r.distance);
      const fastestPace = fastest.finishSeconds/fastest.distance;

      return (
        <div className="react-metrics">
          <div className="react-card">
            <div className="react-tiles">
              <div className="react-tile"><div className="n">{total2025}</div><div className="l">miles in 2025</div></div>
              <div className="react-tile"><div className="n">{races2025}</div><div className="l">races in 2025</div></div>
              <div className="react-tile"><div className="n">{raceMilesAll.toFixed(1)}</div><div className="l">race miles all time</div></div>
              <div className="react-tile"><div className="n">{paceStr(fastestPace)}</div><div className="l">fastest race pace</div></div>
            </div>
            <div style={{height:10}}></div>
            <MilesBarChart data={TRAINING} />
          </div>

          <StravaCard/>
        </div>
      );
    }

    /* ------------ app ------------- */
    function RacesApp(){
      return (
        <div className="react-wrap">
          <TopBlock/>
          <div style={{height:14}}></div>
          <div className="react-stack">
            {RACES.map(r => <RaceCard key={r.id} race={r} />)}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("races-app")).render(<RacesApp />);
  </script>
</body>
</html>
