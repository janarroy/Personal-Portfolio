<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Races</title>

  <link rel="stylesheet" href="styles.css?v=18"/>

  <style>
    /* ---------- scoped styles for the React widget ---------- */
    .react-wrap{ display:block; }
    .react-metrics{ display:grid; gap:14px; grid-template-columns: 1.2fr 1fr; }
    @media (max-width:900px){ .react-metrics{ grid-template-columns:1fr; } }

    .react-card{ background:#fff; border:1px solid rgba(17,19,24,.10); border-radius:16px; padding:16px; box-shadow:0 10px 30px rgba(17,19,24,.04); }

    /* metric tiles */
    .react-tiles{ display:grid; gap:10px; grid-template-columns:repeat(4, minmax(0,1fr)); }
    @media (max-width:640px){ .react-tiles{ grid-template-columns:repeat(2, minmax(0,1fr)); } }
    .react-tile{ border:1px solid rgba(0,0,0,.06); border-radius:12px; padding:12px; background:#fff; }
    .react-tile .n{ font-weight:800; font-size:22px; letter-spacing:.2px; background:linear-gradient(90deg,#1d4ed8,#06b6d4); -webkit-background-clip:text; background-clip:text; color:transparent; }
    .react-tile .l{ font-size:12px; color:#6b7280; margin-top:4px; }

    /* simple bar chart */
    .react-chart-title{ font-size:13px; font-weight:700; color:#374151; margin-bottom:8px; }
    .react-bars-wrap{ border:1px solid rgba(17,19,24,.10); border-radius:12px; padding:10px; background:#fff; }
    .react-bars{ display:grid; grid-auto-flow:column; grid-auto-columns:1fr; align-items:end; height:160px; gap:8px; padding:8px 6px 2px; }
    .react-bar{ position:relative; background:#e5efff; border:1px solid #c7dbff; border-radius:6px 6px 0 0; }
    .react-bar::after{ content:attr(data-miles) " mi"; position:absolute; left:50%; transform:translateX(-50%); bottom:100%; font-size:11px; color:#374151; margin-bottom:4px; white-space:nowrap; }
    .react-x{ display:grid; grid-auto-flow:column; grid-auto-columns:1fr; gap:8px; margin-top:6px; font-size:11px; color:#6b7280; text-align:center; }

    /* medals row (actual medal images) */
    .react-medals{ display:grid; gap:10px; grid-template-columns:repeat(2, minmax(0,1fr)); }
    @media (max-width:640px){ .react-medals{ grid-template-columns:1fr; } }
    .react-medal{ display:grid; grid-template-columns:88px 1fr; gap:12px; align-items:center; border:1px solid rgba(0,0,0,.06); border-radius:12px; padding:10px; background:#fff; }
    .react-medal .thumb{ width:88px; height:88px; display:grid; place-items:center; border-radius:10px; background:#fff; border:1px solid rgba(0,0,0,.06); overflow:hidden; }
    .react-medal img{ max-width:100%; max-height:100%; object-fit:contain; display:block; }
    .react-medal h4{ margin:0 0 2px; font-size:14px; }
    .react-medal .meta{ font-size:12px; color:#6b7280; }

    /* race cards */
    .react-stack{ display:grid; gap:16px; }
    .react-bar-hdr{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:10px; }
    .react-bar-hdr h2{ margin:0; font-size:18px; }
    .react-date{ color:#60646c; font-size:13px; }

    .react-grid{ display:grid; gap:16px; grid-template-columns:minmax(0,58%) minmax(0,42%); align-items:stretch; }
    @media (max-width:900px){ .react-grid{ grid-template-columns:1fr; } }
    .react-col-media{ min-width:0; }
    .react-col-notes{ min-width:0; display:flex; flex-direction:column; gap:10px; background:#fff; border:1px solid rgba(17,19,24,.10); border-radius:14px; padding:12px; }

    .react-title{ margin:0; font-size:16px; }
    .react-meta{ color:#6b7280; font-size:12px; }
    .react-text{ margin:2px 0 0; font-size:15px; line-height:1.55; color:#111318; }
    .react-bullets{ margin:4px 0 0 18px; color:#374151; font-size:14px; }

    .react-stats{ display:grid; grid-template-columns:repeat(3, minmax(0,1fr)); gap:8px; }
    .react-stat{ background:#fff; border:1px solid rgba(0,0,0,.06); border-radius:10px; padding:8px; text-align:center; box-shadow:0 6px 18px rgba(0,0,0,.05); }
    .react-stat-number{ font-weight:800; letter-spacing:.2px; font-size:20px; background:linear-gradient(90deg,#1d4ed8,#06b6d4); -webkit-background-clip:text; background-clip:text; color:transparent; }
    .react-stat-label{ font-size:12px; color:#6b7280; margin-top:2px; }

    .react-tags{ display:flex; flex-wrap:wrap; gap:6px; margin-top:2px; }
    .react-tag{ font-size:12px; padding:3px 6px; border:1px solid rgba(17,19,24,.12); border-radius:999px; background:#fff; color:#374151; }
    .react-pr{ color:#0ea5e9; font-weight:700; }

    /* slider (no crop) */
    .react-slider{ position:relative; width:100%; border-radius:14px; overflow:hidden; background:#fff; }
    .react-slides{ display:grid; grid-auto-flow:column; grid-auto-columns:100%; transition: transform .35s ease; }
    .react-slide{ display:flex; align-items:flex-start; justify-content:center; }
    .react-media{ width:100%; height:auto; object-fit:contain; display:block; background:#fff; border-radius:14px; max-height:80vh; }
    .react-video{ background:#000; }
    .react-nav{ position:absolute; top:50%; transform:translateY(-50%); z-index:2; width:36px; height:36px; border-radius:999px; border:0; cursor:pointer; background:rgba(17,19,24,.65); color:#fff; display:grid; place-items:center; }
    .react-prev{ left:10px; } .react-next{ right:10px; }
    .react-nav:hover{ background:rgba(17,19,24,.8); }
    .react-dots{ position:absolute; left:50%; bottom:10px; transform:translateX(-50%); display:flex; gap:6px; z-index:2; }
    .react-dot{ width:8px; height:8px; border-radius:999px; border:0; background:rgba(17,19,24,.25); cursor:pointer; }
    .react-dot.on{ background:rgba(17,19,24,.6); }
  </style>
</head>

<body class="plain-bg">
  <nav class="nav">
    <div class="container nav-inner">
      <a class="brand" href="index.html">Jan</a>
      <div class="nav-links">
        <a class="btn" href="index.html#work">Projects</a>
        <a class="btn" href="races.html">Races</a>
        <a class="btn" href="#bake">Bake</a>
        <a class="btn" href="#travel">Travel</a>
        <a class="btn" href="#contact">Contact</a>
      </div>
    </div>
  </nav>

  <main class="container work">
    <h1 class="page-title">Races</h1>
    <p class="tag">Marathons & distance events I’ve run.</p>

    <div id="races-app"></div>
  </main>

  <footer>© <span id="year"></span> Jan Arroyo — Thanks for visiting!</footer>
  <script>document.getElementById('year').textContent = new Date().getFullYear();</script>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useEffect, useRef, useState } = React;

    /* ------------ DATA ------------- */
    const RACES = [
      {
        id: "sf10k-2025",
        dateISO: "2025-07-27",
        dateLabel: "July 27, 2025",
        title: "San Francisco 10K",
        distance: 6.2,
        trainingMiles: 120,             // update if you want
        finishSeconds: 4200,            // keep in seconds; edit time here, pace updates everywhere
        description:
          "Ran side-by-side with my girlfriend while we were in SF for the summer. Cool air, rolling streets, easy to smile the whole way.",
        bullets: [
          "Course: rolling streets + cool coastal air",
          "Fuel: water only — gel pre-start",
          "Shoes: Hoka Clifton 9",
          "Next goal: stronger middle miles",
        ],
        medal: "images/medals/sf10k-medal.jpg",  // <- put the medal photo here
        media: [
          { type: "img", src: "images/races/SF10K.JPG",  alt: "San Francisco 10K" },
          { type: "img", src: "images/races/SF10K1.JPG", alt: "San Francisco 10K — finish" },
        ],
      },
      {
        id: "surf-city-2025",
        dateISO: "2025-02-02",
        dateLabel: "February 2, 2025",
        title: "Surf City Marathon",
        distance: 26.2,
        trainingMiles: 820,
        finishSeconds: 14280,           // e.g. 3:58:00; change as needed
        description:
          "First full. Windy along PCH, big crowd energy, and a sub-4 that felt massive.",
        bullets: [
          "Course: out-and-back along PCH",
          "Fuel: gels + electrolytes every 5–6 miles",
          "Shoes: Hoka Clifton 9",
          "Next goal: stronger last 10K",
        ],
        medal: "images/medals/surfcity-medal.jpg", // <- put the marathon medal photo here
        media: [
          { type: "img",   src: "images/races/SurfCity1.JPG", alt: "Surf City — finish" },
          { type: "img",   src: "images/races/SurfCity2.JPG", alt: "Surf City — course" },
          { type: "img",   src: "images/races/SurfCity3.JPG", alt: "Surf City — friends" },
          { type: "video", src: "images/races/SurfCity4.mp4", alt: "Surf City — finish video" },
        ],
      },
      {
        id: "long-beach-2024",
        dateISO: "2024-10-06",
        dateLabel: "October 6, 2024",
        title: "Long Beach Half Marathon",
        distance: 13.1,
        trainingMiles: 471,
        finishSeconds: 7140,            // 1:59:00
        description:
          "Half with Emma. Messy training, early morning, and a sub-2 that still makes me grin.",
        bullets: [
          "Course: flat waterfront + coastal breeze",
          "Fuel: gels + water at every station",
          "Shoes: Hoka Clifton 9",
          "Next time: try for a negative split",
        ],
        medal: "images/medals/longbeach-medal.jpg", // optional
        media: [
          { type: "img", src: "images/races/LongBeachHalf1.JPG", alt: "Long Beach Half — medal" },
          { type: "img", src: "images/races/LongBeachHalf2.JPG", alt: "Long Beach Half — cheering squad" },
          { type: "img", src: "images/races/LongBeachHalf3.JPG", alt: "Long Beach Half — finish area" },
        ],
      },
    ];

    const TRAINING = [
      { week: "2024-12-15", miles: 18 },
      { week: "2024-12-22", miles: 22 },
      { week: "2024-12-29", miles: 24 },
      { week: "2025-01-05", miles: 28 },
      { week: "2025-01-12", miles: 35 },
      { week: "2025-01-19", miles: 41 },
      { week: "2025-01-26", miles: 32 },
      { week: "2025-02-02", miles: 10 },
    ];

    /* ------------ HELPERS ------------- */
    const pad = (n)=>String(n).padStart(2,"0");
    const formatTime = (totalSeconds) => {
      const s = Math.round(totalSeconds);
      const h = Math.floor(s / 3600);
      const m = Math.floor((s % 3600) / 60);
      const r = s % 60;
      return h > 0 ? `${h}:${pad(m)}:${pad(r)}` : `${m}:${pad(r)}`;
    };
    const paceStr = (secsPerMile)=>{
      const m = Math.floor(secsPerMile/60), s = Math.round(secsPerMile%60);
      return `${m}:${pad(s)}/mi`;
    };
    const sum = (arr, key)=>arr.reduce((t,x)=>t+(typeof key==="function"?key(x):x[key]),0);
    const minBy = (arr, f)=>arr.reduce((best,x)=>f(x)<f(best)?x:best, arr[0]);

    /* ------------ bar chart ------------- */
    function MilesBarChart({ data }) {
      const max = Math.max(1, ...data.map(d=>d.miles));
      return (
        <div className="react-bars-wrap">
          <div className="react-chart-title">Weekly training miles</div>
          <div className="react-bars">
            {data.map((d,i)=>(
              <div key={i}
                   className="react-bar"
                   data-miles={d.miles}
                   style={{ height: `${(d.miles/max)*100}%` }} />
            ))}
          </div>
          <div className="react-x">
            {data.map((d,i)=> <div key={i}>{d.week.slice(5)}</div>)}
          </div>
        </div>
      );
    }

    /* ------------ slider (no crop) ------------- */
    function MediaSlider({ media }) {
      const [i, setI] = useState(0);
      const trackRef = useRef(null);
      const go = (n)=>setI(p=>(n+media.length)%media.length);

      const measure = ()=>{
        const el=trackRef.current; if(!el) return;
        const slide=el.children[i]; if(!slide) return;
        const h = slide.getBoundingClientRect().height;
        el.style.height = h ? `${h}px` : "auto";
      };
      useEffect(()=>{ requestAnimationFrame(measure); },[i, media]);
      useEffect(()=>{ const on=()=>measure(); window.addEventListener('resize',on); return ()=>window.removeEventListener('resize',on); },[]);

      return (
        <div className="react-slider">
          <div ref={trackRef} className="react-slides" style={{ transform:`translateX(-${i*100}%)` }}>
            {media.map((m,idx)=>(
              <div key={idx} className="react-slide">
                {m.type==="img" ? (
                  <img src={m.src} alt={m.alt} className="react-media"
                       loading={idx===0?"eager":"lazy"} onLoad={measure}/>
                ) : (
                  <video controls className="react-media react-video" onLoadedMetadata={measure}>
                    <source src={m.src} type="video/mp4"/>
                  </video>
                )}
              </div>
            ))}
          </div>
          <button className="react-nav react-prev" aria-label="Previous" onClick={()=>go(i-1)}>‹</button>
          <button className="react-nav react-next" aria-label="Next" onClick={()=>go(i+1)}>›</button>
          <div className="react-dots">
            {media.map((_,idx)=>(
              <button key={idx} className={("react-dot "+(idx===i?"on":""))} onClick={()=>setI(idx)} aria-label={`Go to slide ${idx+1}`}/>
            ))}
          </div>
        </div>
      );
    }

    /* ------------ small pieces ------------- */
    function StatTile({ label, value, isTime=false }) {
      return (
        <div className="react-stat">
          <div className="react-stat-number">{isTime ? formatTime(value) : value}</div>
          <div className="react-stat-label">{label}</div>
        </div>
      );
    }

    function TagRow({ race, fastestPace }){
      const tags=[];
      race.bullets.forEach(b=>{
        const [k,v] = b.split(":"); if(!v) return;
        const key=k.trim(), val=v.trim();
        if(key==="Course") tags.push(val);
        if(key==="Fuel")   tags.push(`Fuel: ${val}`);
        if(key==="Shoes")  tags.push(`Shoes: ${val}`);
      });
      const myPace = race.finishSeconds / race.distance;
      const isPR = Math.abs(myPace - fastestPace) < 0.01; // within ~0.6 sec/mi
      return (
        <div className="react-tags">
          <span className="react-tag">Avg pace: {paceStr(myPace)}{isPR ? " · " : ""}</span>
          {isPR && <span className="react-tag react-pr">PR</span>}
          {tags.map((t,i)=><span className="react-tag" key={i}>{t}</span>)}
        </div>
      );
    }

    function MedalCard({ race }){
      const src = race.medal || (race.media.find(m=>m.type==="img")||{}).src;
      const p = race.finishSeconds / race.distance;
      return (
        <div className="react-medal">
          <div className="thumb">
            {src ? <img src={src} alt={`${race.title} medal`}/> : <div className="meta">No medal image yet</div>}
          </div>
          <div>
            <h4>{race.title}</h4>
            <div className="meta">{race.dateLabel} · {race.distance} mi · {formatTime(race.finishSeconds)} ({paceStr(p)})</div>
          </div>
        </div>
      );
    }

    function RaceCard({ race, fastestPace }) {
      const pace = race.finishSeconds / race.distance;
      return (
        <section className="react-card">
          <div className="react-bar-hdr">
            <h2>{race.title}</h2>
            <span className="react-date">{race.dateLabel}</span>
          </div>

          <div className="react-grid">
            <div className="react-col-media">
              <MediaSlider media={race.media} />
            </div>

            <div className="react-col-notes">
              <h3 className="react-title">{race.title}</h3>
              <div className="react-meta">{race.dateLabel} · {race.distance} miles</div>

              <div className="react-stats">
                <StatTile label="training miles" value={race.trainingMiles} />
                <StatTile label="finish" value={race.finishSeconds} isTime />
                <StatTile label="avg pace" value={paceStr(pace)} />
              </div>

              <TagRow race={race} fastestPace={fastestPace} />

              <p className="react-text">{race.description}</p>
              <ul className="react-bullets">
                {race.bullets.map((b,i)=><li key={i}>{b}</li>)}
              </ul>
            </div>
          </div>
        </section>
      );
    }

    /* ------------ top area ------------- */
    function TopBlock(){
      const total2025 = sum(TRAINING.filter(d=>d.week.startsWith("2025")), "miles");
      const races2025 = RACES.filter(r=>r.dateISO.startsWith("2025")).length;
      const raceMilesAll = sum(RACES, "distance");
      const fastest = minBy(RACES, r => r.finishSeconds/r.distance); // fastest pace race
      const fastestPace = fastest.finishSeconds/fastest.distance;

      return (
        <div className="react-metrics">
          <div className="react-card">
            <div className="react-tiles">
              <div className="react-tile"><div className="n">{total2025}</div><div className="l">miles in 2025</div></div>
              <div className="react-tile"><div className="n">{races2025}</div><div className="l">races in 2025</div></div>
              <div className="react-tile"><div className="n">{raceMilesAll.toFixed(1)}</div><div className="l">race miles (all-time)</div></div>
              <div className="react-tile"><div className="n">{paceStr(fastestPace)}</div><div className="l">fastest race pace</div></div>
            </div>
            <div style={{height:10}}></div>
            <MilesBarChart data={TRAINING} />
          </div>

          <div className="react-card">
            <div style={{fontSize:13, fontWeight:700, color:"#374151", marginBottom:8}}>Medals</div>
            <div className="react-medals">
              {RACES.filter(r=>r.medal).map(r => <MedalCard key={r.id} race={r} />)}
            </div>
          </div>
        </div>
      );
    }

    /* ------------ app ------------- */
    function RacesApp(){
      const fastest = minBy(RACES, r => r.finishSeconds/r.distance);
      const fastestPace = fastest.finishSeconds/fastest.distance;
      return (
        <div className="react-wrap">
          <TopBlock/>
          <div style={{height:14}}></div>
          <div className="react-stack">
            {RACES.map(r => <RaceCard key={r.id} race={r} fastestPace={fastestPace} />)}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("races-app")).render(<RacesApp />);
  </script>
</body>
</html>
