<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Races</title>

  <link rel="stylesheet" href="styles.css?v=17"/>

  <style>
    /* ---------- scoped styles for the React widget ---------- */
    .react-wrap{ display:block; }
    .react-metrics{ display:grid; gap:14px; grid-template-columns: 1.2fr 1fr; }
    @media (max-width:900px){ .react-metrics{ grid-template-columns:1fr; } }

    .react-card{ background:#fff; border:1px solid rgba(17,19,24,.10); border-radius:16px; padding:16px; box-shadow:0 10px 30px rgba(17,19,24,.04); }

    /* metric tiles */
    .react-tiles{ display:grid; gap:10px; grid-template-columns:repeat(4, minmax(0,1fr)); }
    @media (max-width:640px){ .react-tiles{ grid-template-columns:repeat(2, minmax(0,1fr)); } }
    .react-tile{ border:1px solid rgba(0,0,0,.06); border-radius:12px; padding:12px; background:#fff; }
    .react-tile .n{ font-weight:800; font-size:22px; letter-spacing:.2px; background:linear-gradient(90deg,#1d4ed8,#06b6d4); -webkit-background-clip:text; background-clip:text; color:transparent; }
    .react-tile .l{ font-size:12px; color:#6b7280; margin-top:4px; }

    /* chart */
    .react-chart-title{ font-size:13px; font-weight:700; color:#374151; margin-bottom:8px; }
    .react-chart{ border:1px solid rgba(17,19,24,.10); border-radius:12px; }
    .react-chart-legend{ display:flex; flex-wrap:wrap; gap:6px; margin-top:8px; }
    .react-chip{ font-size:12px; padding:3px 6px; border:1px solid rgba(17,19,24,.12); border-radius:999px; background:#fff; color:#374151; }

    /* medals row */
    .react-medals{ display:grid; gap:10px; grid-template-columns:repeat(2, minmax(0,1fr)); }
    @media (max-width:640px){ .react-medals{ grid-template-columns:1fr; } }
    .react-medal{ display:grid; grid-template-columns:72px 1fr; gap:10px; align-items:center; border:1px solid rgba(0,0,0,.06); border-radius:12px; padding:10px; background:#fff; }
    .react-medal .thumb{ width:72px; height:72px; display:grid; place-items:center; border-radius:10px; background:#fff; border:1px solid rgba(0,0,0,.06); overflow:hidden; }
    .react-medal img{ max-width:100%; max-height:100%; object-fit:contain; display:block; }
    .react-medal h4{ margin:0 0 2px; font-size:14px; }
    .react-medal .meta{ font-size:12px; color:#6b7280; }

    /* race cards */
    .react-stack{ display:grid; gap:16px; }
    .react-bar{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:10px; }
    .react-bar h2{ margin:0; font-size:18px; }
    .react-date{ color:#60646c; font-size:13px; }

    .react-grid{ display:grid; gap:16px; grid-template-columns:minmax(0,58%) minmax(0,42%); align-items:stretch; }
    @media (max-width:900px){ .react-grid{ grid-template-columns:1fr; } }
    .react-col-media{ min-width:0; }
    .react-col-notes{ min-width:0; display:flex; flex-direction:column; gap:10px; background:#fff; border:1px solid rgba(17,19,24,.10); border-radius:14px; padding:12px; }

    .react-title{ margin:0; font-size:16px; }
    .react-meta{ color:#6b7280; font-size:12px; }
    .react-text{ margin:2px 0 0; font-size:15px; line-height:1.55; color:#111318; }
    .react-bullets{ margin:4px 0 0 18px; color:#374151; font-size:14px; }

    .react-stats{ display:grid; grid-template-columns:repeat(3, minmax(0,1fr)); gap:8px; }
    .react-stat{ background:#fff; border:1px solid rgba(0,0,0,.06); border-radius:10px; padding:8px; text-align:center; box-shadow:0 6px 18px rgba(0,0,0,.05); }
    .react-stat-number{ font-weight:800; letter-spacing:.2px; font-size:20px; background:linear-gradient(90deg,#1d4ed8,#06b6d4); -webkit-background-clip:text; background-clip:text; color:transparent; }
    .react-stat-label{ font-size:12px; color:#6b7280; margin-top:2px; }

    .react-tags{ display:flex; flex-wrap:wrap; gap:6px; margin-top:2px; }
    .react-tag{ font-size:12px; padding:3px 6px; border:1px solid rgba(17,19,24,.12); border-radius:999px; background:#fff; color:#374151; }

    /* slider (no crop) */
    .react-slider{ position:relative; width:100%; border-radius:14px; overflow:hidden; background:#fff; }
    .react-slides{ display:grid; grid-auto-flow:column; grid-auto-columns:100%; transition: transform .35s ease; }
    .react-slide{ display:flex; align-items:flex-start; justify-content:center; }
    .react-media{ width:100%; height:auto; object-fit:contain; display:block; background:#fff; border-radius:14px; max-height:80vh; }
    .react-video{ background:#000; }
    .react-nav{ position:absolute; top:50%; transform:translateY(-50%); z-index:2; width:36px; height:36px; border-radius:999px; border:0; cursor:pointer; background:rgba(17,19,24,.65); color:#fff; display:grid; place-items:center; }
    .react-prev{ left:10px; } .react-next{ right:10px; }
    .react-nav:hover{ background:rgba(17,19,24,.8); }
    .react-dots{ position:absolute; left:50%; bottom:10px; transform:translateX(-50%); display:flex; gap:6px; z-index:2; }
    .react-dot{ width:8px; height:8px; border-radius:999px; border:0; background:rgba(17,19,24,.25); cursor:pointer; }
    .react-dot.on{ background:rgba(17,19,24,.6); }
  </style>
</head>

<body class="plain-bg">
  <nav class="nav">
    <div class="container nav-inner">
      <a class="brand" href="index.html">Jan</a>
      <div class="nav-links">
        <a class="btn" href="index.html#work">Projects</a>
        <a class="btn" href="races.html">Races</a>
        <a class="btn" href="#bake">Bake</a>
        <a class="btn" href="#travel">Travel</a>
        <a class="btn" href="#contact">Contact</a>
      </div>
    </div>
  </nav>

  <main class="container work">
    <h1 class="page-title">Races</h1>
    <p class="tag">Marathons & distance events I’ve run.</p>

    <div id="races-app"></div>
  </main>

  <footer>© <span id="year"></span> Jan Arroyo — Thanks for visiting!</footer>
  <script>document.getElementById('year').textContent = new Date().getFullYear();</script>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useEffect, useMemo, useRef, useState } = React;

    /* ------------ DATA ------------- */
    const RACES = [
      {
        id: "sf10k-2025",
        dateISO: "2025-07-27",
        dateLabel: "July 27, 2025",
        title: "San Francisco 10K",
        distance: 6.2,
        trainingMiles: 120,
        finishSeconds: 4200,
        description:
          "Ran it side-by-side with my girlfriend while we were in SF for the summer. Cool air, rolling streets, and a good day overall.",
        bullets: [
          "Course: rolling streets + cool coastal air",
          "Fuel: light (water only) — gel pre-start",
          "Shoes: (fill in)",
          "Next goal: stronger middle miles",
        ],
        media: [
          { type: "img", src: "images/races/SF10K.JPG",  alt: "San Francisco 10K – medal & bib" },
          { type: "img", src: "images/races/SF10K1.JPG", alt: "San Francisco 10K – after the finish" },
        ],
      },
      {
        id: "surf-city-2025",
        dateISO: "2025-02-02",
        dateLabel: "February 2, 2025",
        title: "Surf City Marathon",
        distance: 26.2,
        trainingMiles: 820,
        finishSeconds: 14280, // 3:58:00
        description:
          "First full marathon. Windy along PCH, loud crowd, and a sub-4 finish that felt huge.",
        bullets: [
          "Course: out-and-back along PCH",
          "Fuel: gels + electrolytes every 5–6 miles",
          "Shoes: (fill in)",
          "Next goal: stronger last 10K",
        ],
        media: [
          { type: "img",   src: "images/races/SurfCity1.JPG", alt: "Surf City – family at the finish" },
          { type: "img",   src: "images/races/SurfCity2.JPG", alt: "Surf City – course fence" },
          { type: "img",   src: "images/races/SurfCity3.JPG", alt: "Surf City – friends at the finish" },
          { type: "video", src: "images/races/SurfCity4.mp4", alt: "Surf City – finish video" },
        ],
      },
      {
        id: "long-beach-2024",
        dateISO: "2024-10-06",
        dateLabel: "October 6, 2024",
        title: "Long Beach Half Marathon",
        distance: 13.1,
        trainingMiles: 471,
        finishSeconds: 7140, // 1:59:00
        description:
          "First half with Emma. Messy training, fun race, snuck in under two hours.",
        bullets: [
          "Course: flat waterfront + coastal breeze",
          "Fuel: gels + water at every station",
          "Shoes: (fill in)",
          "Next time: aim for a negative split",
        ],
        media: [
          { type: "img", src: "images/races/LongBeachHalf1.JPG", alt: "Long Beach Half – medal" },
          { type: "img", src: "images/races/LongBeachHalf2.JPG", alt: "Long Beach Half – cheering squad" },
          { type: "img", src: "images/races/LongBeachHalf3.JPG", alt: "Long Beach Half – finish area" },
        ],
      },
    ];

    const TRAINING = [
      { week: "2024-12-15", miles: 18 },
      { week: "2024-12-22", miles: 22 },
      { week: "2024-12-29", miles: 24 },
      { week: "2025-01-05", miles: 28 },
      { week: "2025-01-12", miles: 35 },
      { week: "2025-01-19", miles: 41 },
      { week: "2025-01-26", miles: 32 },
      { week: "2025-02-02", miles: 10 },
    ];

    /* ------------ HELPERS ------------- */
    const pad = (n)=>String(n).padStart(2,"0");
    const formatTime = (totalSeconds) => {
      const s = Math.round(totalSeconds);
      const h = Math.floor(s / 3600);
      const m = Math.floor((s % 3600) / 60);
      const r = s % 60;
      return h > 0 ? `${h}:${pad(m)}:${pad(r)}` : `${m}:${pad(r)}`;
    };
    const paceStr = (secsPerMile)=>{
      const m = Math.floor(secsPerMile/60), s = Math.round(secsPerMile%60);
      return `${m}:${pad(s)}/mi`;
    };
    const cx = (...xs) => xs.filter(Boolean).join(" ");

    const sum = (arr, key)=>arr.reduce((t,x)=>t+(typeof key==="function"?key(x):x[key]),0);

    /* ------------ CHART ------------- */
    function TinyLineChart({ data }) {
      const w = 560, h = 160, padXY = 24;
      const ys = data.map(d => d.miles);
      const yMax = Math.max(1, ...ys);
      const points = data.map((d,i)=>{
        const x = padXY + (i/(data.length-1||1))*(w-padXY*2);
        const y = h - padXY - (d.miles/yMax)*(h-padXY*2);
        return `${x},${y}`;
      }).join(" ");
      return (
        <div className="react-card">
          <div className="react-chart-title">Weekly training miles</div>
          <svg width={w} height={h} viewBox={`0 0 ${w} ${h}`} className="react-chart">
            <rect x="0" y="0" width={w} height={h} fill="#fff" rx="12" />
            <polyline fill="none" stroke="#e5e7eb" strokeWidth="1"
              points={`${padXY},${h-padXY} ${w-padXY},${h-padXY}`} />
            <polyline fill="none" stroke="#3b82f6" strokeWidth="2.5" points={points} />
          </svg>
          <div className="react-chart-legend">
            {data.map((d,i)=>(<span key={i} className="react-chip">{d.week.slice(5)} · {d.miles} mi</span>))}
          </div>
        </div>
      );
    }

    /* ------------ SLIDER ------------- */
    function MediaSlider({ media }) {
      const [i, setI] = useState(0);
      const trackRef = useRef(null);
      const go = (n)=>setI(p=>(n+media.length)%media.length);

      const measure = ()=>{
        const el=trackRef.current; if(!el) return;
        const slide=el.children[i]; if(!slide) return;
        const h = slide.getBoundingClientRect().height;
        el.style.height = h ? `${h}px` : "auto";
      };
      useEffect(()=>{ requestAnimationFrame(measure); },[i, media]);
      useEffect(()=>{ const on=()=>measure(); window.addEventListener('resize',on); return ()=>window.removeEventListener('resize',on); },[]);

      return (
        <div className="react-slider">
          <div ref={trackRef} className="react-slides" style={{ transform:`translateX(-${i*100}%)` }}>
            {media.map((m,idx)=>(
              <div key={idx} className="react-slide">
                {m.type==="img" ? (
                  <img src={m.src} alt={m.alt} className="react-media"
                       loading={idx===0?"eager":"lazy"} onLoad={measure}/>
                ) : (
                  <video controls className="react-media react-video" onLoadedMetadata={measure}>
                    <source src={m.src} type="video/mp4"/>
                  </video>
                )}
              </div>
            ))}
          </div>
          <button className="react-nav react-prev" aria-label="Previous" onClick={()=>go(i-1)}>‹</button>
          <button className="react-nav react-next" aria-label="Next" onClick={()=>go(i+1)}>›</button>
          <div className="react-dots">
            {media.map((_,idx)=>(
              <button key={idx} className={cx("react-dot", idx===i && "on")} onClick={()=>setI(idx)} aria-label={`Go to slide ${idx+1}`}/>
            ))}
          </div>
        </div>
      );
    }

    /* ------------ SMALL PIECES ------------- */
    function StatTile({ label, value, isTime=false }) {
      return (
        <div className="react-stat">
          <div className="react-stat-number">{isTime ? formatTime(value) : value}</div>
          <div className="react-stat-label">{label}</div>
        </div>
      );
    }

    function MedalCard({ race }){
      const firstImg = race.media.find(m=>m.type==="img") || race.media[0];
      const p = paceStr(race.finishSeconds / race.distance);
      return (
        <div className="react-medal">
          <div className="thumb">
            {firstImg?.type==="img"
              ? <img src={firstImg.src} alt={`${race.title} medal`}/>
              : <div className="meta">video</div>}
          </div>
          <div>
            <h4>{race.title}</h4>
            <div className="meta">{race.dateLabel} · {race.distance} mi · {formatTime(race.finishSeconds)} ({p})</div>
          </div>
        </div>
      );
    }

    function parseTags(bullets){
      const tags=[];
      bullets.forEach(b=>{
        const [k,v] = b.split(":");
        if(!v) return;
        const key = k.trim(); const val = v.trim();
        if(key==="Course") tags.push(val);
        if(key==="Fuel")   tags.push(`Fuel: ${val}`);
        if(key==="Shoes")  tags.push(`Shoes: ${val}`);
      });
      return tags;
    }

    /* ------------ RACE CARD ------------- */
    function RaceCard({ race }) {
      const pace = race.finishSeconds / race.distance;
      const tags = parseTags(race.bullets);
      return (
        <section className="react-card">
          <div className="react-bar">
            <h2>{race.title}</h2>
            <span className="react-date">{race.dateLabel}</span>
          </div>

          <div className="react-grid">
            <div className="react-col-media">
              <MediaSlider media={race.media} />
            </div>

            <div className="react-col-notes">
              <h3 className="react-title">{race.title}</h3>
              <div className="react-meta">{race.dateLabel} · {race.distance} miles</div>

              <div className="react-stats">
                <StatTile label="training miles" value={race.trainingMiles} />
                <StatTile label="finish" value={race.finishSeconds} isTime />
                <StatTile label="avg pace" value={paceStr(pace)} />
              </div>

              {tags.length>0 && (
                <div className="react-tags">
                  {tags.map((t,i)=><span className="react-tag" key={i}>{t}</span>)}
                </div>
              )}

              <p className="react-text">{race.description}</p>
              <ul className="react-bullets">
                {race.bullets.map((b,i)=><li key={i}>{b}</li>)}
              </ul>
            </div>
          </div>
        </section>
      );
    }

    /* ------------ TOP AREA (metrics + medals + chart) ------------- */
    function TopBlock(){
      const total2025 = sum(TRAINING.filter(d=>d.week.startsWith("2025")), "miles");
      const races2025 = RACES.filter(r=>r.dateISO.startsWith("2025")).length;
      const raceMilesAll = sum(RACES, "distance");
      const fastestPace = Math.min(...RACES.map(r=>r.finishSeconds/r.distance));

      const medals = RACES.filter(r=>["sf10k-2025","surf-city-2025"].includes(r.id));

      return (
        <div className="react-metrics">
          <div className="react-card">
            <div className="react-tiles">
              <div className="react-tile"><div className="n">{total2025}</div><div className="l">miles in 2025</div></div>
              <div className="react-tile"><div className="n">{races2025}</div><div className="l">races in 2025</div></div>
              <div className="react-tile"><div className="n">{raceMilesAll.toFixed(1)}</div><div className="l">race miles (all-time)</div></div>
              <div className="react-tile"><div className="n">{paceStr(fastestPace)}</div><div className="l">fastest race pace</div></div>
            </div>
            <div style={{height:10}}></div>
            <TinyLineChart data={TRAINING} />
          </div>

          <div className="react-card">
            <div style={{fontSize:13, fontWeight:700, color:"#374151", marginBottom:8}}>Medals</div>
            <div className="react-medals">
              {medals.map(m => <MedalCard key={m.id} race={m} />)}
            </div>
          </div>
        </div>
      );
    }

    /* ------------ APP ------------- */
    function RacesApp(){
      return (
        <div className="react-wrap">
          <TopBlock/>
          <div style={{height:14}}></div>
          <div className="react-stack">
            {RACES.map(r => <RaceCard key={r.id} race={r} />)}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("races-app")).render(<RacesApp />);
  </script>
</body>
</html>
