<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Work · Jan Arroyo</title>
  <link href="styles.css" rel="stylesheet" />
  <style>
    :root{
      --sep: rgba(17,19,24,.18);
      --muted:#6b7280; --muted2:#7a7f87; --title:#1f2937;
      --card:#ffffff; --bd:rgba(17,19,24,.12);
      --shadow: 0 22px 60px rgba(17,19,24,.10);
      --grad1:#a78bfa; --grad2:#60a5fa; --grad3:#34d399;
    }

    /* ---------- page shells ---------- */
    .page{padding:32px 16px;}
    .narrow{width:min(680px,92vw);margin-inline:auto;}
    .wide{width:min(1120px,95vw);margin-inline:auto;} /* wider Projects */

    .section-title{font-size:22px;margin:26px 0 14px;color:var(--title);font-weight:700;letter-spacing:.2px}

    /* ---------- Work / Involvements (kept) ---------- */
    .list{margin:6px 0 0; padding:0; list-style:none;}
    .row{
      display:flex; align-items:center; justify-content:space-between; gap:16px;
      padding:12px 0; border-bottom:1px dashed var(--sep);
      text-decoration:none; color:inherit;
    }
    .row:focus-visible{outline:2px solid rgba(59,130,246,.5); outline-offset:4px; border-bottom-color:transparent;}
    .left{display:flex; align-items:center; gap:12px; min-width:0;}
    .logo{width:24px;height:24px;display:block;object-fit:contain;border-radius:6px;image-rendering:-webkit-optimize-contrast;transform:translateZ(0)}
    .meta{display:flex; align-items:center; gap:10px; min-width:0;}
    .co{font-weight:600; white-space:nowrap;}
    .role{font-size:13px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
    .right{margin-left:auto; font-size:13px; color:var(--muted2); white-space:nowrap;}
    @media (max-width:560px){ .role{display:none;} }
    footer .narrow, footer .wide{padding:26px 0; font-size:14px; color:var(--muted2);}

    /* ============== Projects: Artistic Bubbles ============== */
    .projects{margin-top:48px;}
    .kicker{margin-top:-2px;color:var(--muted);font-size:13px}
    .proj-list{display:flex;flex-direction:column;gap:28px}

    .bubble{
      position:relative; border-radius:26px; overflow:hidden; background:var(--card);
      border:1px solid var(--bd); box-shadow:var(--shadow);
      background-image:
        radial-gradient(transparent 0, transparent 12px, rgba(17,19,24,.035) 12px),
        linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.92));
      background-size: 22px 22px, auto;
      background-position: -10px -10px, 0 0;
      isolation:isolate;
    }
    .bubble::before{
      content:""; position:absolute; inset:-1px; border-radius:28px; padding:1px;
      background: conic-gradient(from 200deg, var(--grad1), var(--grad2), var(--grad3), var(--grad1));
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor; mask-composite: exclude; pointer-events:none;
    }
    .bubble::after{
      content:""; position:absolute; top:-80px; right:-80px; width:300px; height:300px; border-radius:50%;
      background: radial-gradient(closest-side, rgba(255,255,255,.55), rgba(255,255,255,0));
      filter: blur(16px); pointer-events:none;
    }

    .bubble-grid{
      position:relative; display:grid; gap:18px; align-items:stretch;
      grid-template-columns: 1.75fr 1fr; padding:18px;
    }
    .proj-list .bubble:nth-child(even) .bubble-grid{grid-template-columns: 1fr 1.75fr;}
    .proj-list .bubble:nth-child(even) .media{order:2}
    .proj-list .bubble:nth-child(even) .text{order:1}
    @media (max-width:1020px){ .bubble-grid{grid-template-columns:1fr; padding:16px} }

    /* media pane (PDF canvas or image gallery) */
    .media{
      position:relative; border-radius:18px; overflow:hidden; background:#f7f7f8; border:1px solid var(--bd);
      min-height:560px;
    }
    @media (max-width:1020px){ .media{min-height:380px} }
    .pdf-wrap, .gallery-wrap{position:relative; width:100%; height:100%; display:grid; place-items:center;}
    .pdf-canvas, .lb-canvas, .gallery-img{display:block; max-width:100%; height:auto; background:#fff}

    /* overlay controls */
    .ctrl{
      position:absolute; top:50%; transform:translateY(-50%); z-index:3;
      width:48px; height:48px; border-radius:999px; border:1px solid var(--bd);
      background:rgba(255,255,255,.95); backdrop-filter:saturate(120%) blur(2px);
      display:grid; place-items:center; cursor:pointer; user-select:none;
      box-shadow:0 10px 24px rgba(17,19,24,.18);
    }
    .ctrl:disabled{opacity:.5; cursor:not-allowed}
    .ctrl.prev{left:12px}
    .ctrl.next{right:12px}
    .ctrl svg{width:20px;height:20px}

    .pill{
      position:absolute; top:12px; right:12px; z-index:3;
      font-size:12px; color:#1f2937; background:rgba(255,255,255,.95); border:1px solid var(--bd);
      border-radius:999px; padding:4px 10px;
    }
    .expand-btn{
      position:absolute; top:12px; left:12px; z-index:3;
      font-size:12px; background:rgba(255,255,255,.95); border:1px solid var(--bd);
      border-radius:999px; padding:6px 12px; cursor:pointer;
    }

    /* description pane */
    .text{
      border-radius:18px; border:1px dashed var(--bd); background:rgba(255,255,255,.8);
      backdrop-filter: blur(4px);
      padding:18px; display:flex; flex-direction:column; justify-content:center;
    }
    .text h3{margin:0 0 10px; font-size:22px}
    .text p{margin:0 0 14px; color:var(--muted)}
    .tags{display:flex; gap:8px; flex-wrap:wrap}
    .tag{font-size:12px; padding:6px 10px; border:1px solid var(--bd); border-radius:999px; background:#fff; color:#374151}

    /* Lightbox */
    .lb{position:fixed; inset:0; background:rgba(0,0,0,.7); display:none; align-items:center; justify-content:center; z-index:50}
    .lb.open{display:flex}
    .lb-inner{width:min(1280px,96vw); background:#fff; border-radius:18px; overflow:hidden; box-shadow:0 50px 120px rgba(0,0,0,.38)}
    .lb-head{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid var(--bd)}
    .lb-title{font-weight:600}
    .lb-close{appearance:none;border:1px solid var(--bd);background:#fff;padding:6px 10px;border-radius:8px;cursor:pointer}
    .lb-body{position:relative; background:#fff; display:grid; place-items:center; padding:10px}
    .lb-canvas{display:block; width:100%; height:auto}
    .lb-ctrl{position:absolute; top:50%; transform:translateY(-50%); z-index:8;
      width:54px; height:54px; border-radius:999px; border:1px solid var(--bd); background:rgba(255,255,255,.98);
      display:grid; place-items:center; cursor:pointer; box-shadow:0 12px 28px rgba(17,19,24,.2)}
    .lb-ctrl.prev{left:14px}
    .lb-ctrl.next{right:14px}
    .lb-pill{position:absolute; top:12px; right:12px; background:rgba(255,255,255,.98); border:1px solid var(--bd); border-radius:999px; padding:4px 10px; font-size:12px}
  </style>
</head>
<body>
  <nav class="nav">
    <div class="narrow nav-inner">
      <a class="brand" href="./">JAN</a>
      <div class="nav-links">
        <a class="btn" href="work.html">Projects</a>
        <a class="btn" href="races.html">Races</a>
        <a class="btn" href="bake.html">Bake</a>
        <a class="btn" href="travel.html">Travel</a>
        <a class="btn" href="#contact">Contact</a>
      </div>
    </div>
  </nav>

  <main class="page">
    <!-- (optional) résumé embed zone -->
    <section class="narrow" id="resume-slot"></section>

    <!-- ========= Work (unchanged width) ========= -->
    <section class="narrow">
      <h1 class="section-title">Work</h1>
      <ul class="list" aria-label="Work experience">
        <li>
          <a class="row" href="#" aria-label="USC Marshall Peer Career Advisor – Tech">
            <span class="left">
              <img class="logo" src="images/Marshall.JPG" alt="">
              <span class="meta"><span class="co">USC Marshall</span><span class="role">Peer Career Advisor – Tech</span></span>
            </span>
            <span class="right">Aug 2025</span>
          </a>
        </li>
        <li>
          <a class="row" href="https://www.amazon.jobs/content/en/teams/devices-and-services/lab126" target="_blank" rel="noopener" aria-label="Amazon">
            <span class="left">
              <img class="logo" src="images/Amazon.JPG" alt="">
              <span class="meta"><span class="co">Amazon</span><span class="role">Technical Program Manager Intern</span></span>
            </span>
            <span class="right">May–Aug 2025</span>
          </a>
        </li>
        <li>
          <a class="row" href="https://www.accenture.com/us-en/services/ecosystem-partners/microsoft" target="_blank" rel="noopener" aria-label="Accenture">
            <span class="left">
              <img class="logo" src="images/Accenture.JPG" alt="">
              <span class="meta"><span class="co">Accenture</span><span class="role">Strategy Tech Apps &amp; Dev Analyst Intern</span></span>
            </span>
            <span class="right">Jun–Aug 2024</span>
          </a>
        </li>
        <li>
          <a class="row" href="https://www.apple.com/careers/us/work-at-apple/students.html" target="_blank" rel="noopener" aria-label="Apple">
            <span class="left">
              <img class="logo" src="images/Apple.JPG" alt="">
              <span class="meta"><span class="co">Apple</span><span class="role">Product Management Intern</span></span>
            </span>
            <span class="right">Aug 2023–Jan 2024</span>
          </a>
        </li>
        <li>
          <a class="row" href="https://www.microsoft.com/en-us/modernfinance/digitaltransformation.aspx" target="_blank" rel="noopener" aria-label="Microsoft">
            <span class="left">
              <img class="logo" src="images/Microsoft.JPG" alt="">
              <span class="meta"><span class="co">Microsoft</span><span class="role">Finance Data Analyst Intern</span></span>
            </span>
            <span class="right">May–Aug 2023</span>
          </a>
        </li>
        <li>
          <a class="row" href="https://worldfitforkids.org/" target="_blank" rel="noopener" aria-label="A World Fit For Kids">
            <span class="left">
              <img class="logo" src="images/A-World-Fit-for-Kids.JPG" alt="">
              <span class="meta"><span class="co">A World Fit For Kids</span><span class="role">Strategy Consultant</span></span>
            </span>
            <span class="right">2022–2023</span>
          </a>
        </li>
        <li>
          <a class="row" href="https://www.therams.com/news/rams-la-promise-fund-create-summer-internship-program-for-inglewood-unified-stud" target="_blank" rel="noopener" aria-label="Los Angeles Rams">
            <span class="left">
              <img class="logo" src="images/LARAMS.JPG" alt="">
              <span class="meta"><span class="co">Los Angeles Rams</span><span class="role">Data &amp; Systems Analyst – Intern</span></span>
            </span>
            <span class="right">Jun–Aug 2021</span>
          </a>
        </li>
        <li>
          <a class="row" href="https://www.therams.com/news/rams-la-promise-fund-create-summer-internship-program-for-inglewood-unified-stud" target="_blank" rel="noopener" aria-label="LA Conservation Corps">
            <span class="left">
              <img class="logo" src="images/LACC.JPG" alt="">
              <span class="meta"><span class="co">LA Conservation Corps</span><span class="role">Project Lead</span></span>
            </span>
            <span class="right">Dec 2019–May 2020</span>
          </a>
        </li>
      </ul>

      <h2 class="section-title">Involvements</h2>
      <ul class="list" aria-label="Student & community involvement">
        <li>
          <a class="row" href="https://www.uscbtg.org/" target="_blank" rel="noopener" aria-label="Business Technology Group (USC)">
            <span class="left">
              <img class="logo" src="images/BTG.JPG" alt="">
              <span class="meta"><span class="co">Business Technology Group (USC)</span><span class="role">VP of Projects</span></span>
            </span>
            <span class="right">2024–Present</span>
          </a>
        </li>
        <li>
          <a class="row" href="https://www.ey.com/en_us/about-us/corporate-responsibility/mentoring-of-the-future-workforce-strengthens-communities-and-careers" target="_blank" rel="noopener" aria-label="EY CMAP">
            <span class="left">
              <img class="logo" src="images/EY.JPG" alt="">
              <span class="meta"><span class="co">EY CMAP</span><span class="role">Education Strategy Consultant</span></span>
            </span>
            <span class="right">2023–Present</span>
          </a>
        </li>
        <li>
          <a class="row" href="https://uscfgsa.carrd.co/" target="_blank" rel="noopener" aria-label="USC First-Generation Student Center">
            <span class="left">
              <img class="logo" src="images/FGSA.JPG" alt="">
              <span class="meta"><span class="co">USC First-Generation Student Center</span><span class="role">Program Manager</span></span>
            </span>
            <span class="right">2023–2025</span>
          </a>
        </li>
        <li>
          <a class="row" href="https://www.usclbsa.com/" target="_blank" rel="noopener" aria-label="Latino Business Student Association">
            <span class="left">
              <img class="logo" src="images/LBSA.JPG" alt="">
              <span class="meta"><span class="co">Latino Business Student Association</span><span class="role">Member</span></span>
            </span>
            <span class="right">2023–2025</span>
          </a>
        </li>
        <li>
          <a class="row" href="https://www.uscisa.org/" target="_blank" rel="noopener" aria-label="International Student Assembly">
            <span class="left">
              <img class="logo" src="images/ISA.JPG" alt="">
              <span class="meta"><span class="co">International Student Assembly</span><span class="role">Advocacy &amp; Program Manager Intern</span></span>
            </span>
            <span class="right">2023–2024</span>
          </a>
        </li>
        <li>
          <a class="row" href="https://partnershipla.org/who-we-are/" target="_blank" rel="noopener" aria-label="The LA Partnership">
            <span class="left">
              <img class="logo" src="images/Partnership.JPG" alt="">
              <span class="meta"><span class="co">The LA Partnership</span><span class="role">Policy Advisory Board Member</span></span>
            </span>
            <span class="right">2021–2022</span>
          </a>
        </li>
      </ul>
    </section>

    <!-- ========= Projects (wider, alternating art bubbles) ========= -->
    <section class="wide projects" id="projects">
      <div class="kicker">Projects &amp; Artifacts</div>
      <h2 class="section-title" style="margin-top:4px;">Spotlight</h2>

      <div class="proj-list">

        <!-- 1) QUOKKA (single PDF) -->
        <article class="bubble">
          <div class="bubble-grid">
            <div class="media deck"
                 data-type="pdf-single"
                 data-title="Quokka Brew — Design Research Deck"
                 data-src="Projects/Quokka%20Brew.pdf"
                 tabindex="0" aria-label="Quokka deck viewer">
              <button class="expand-btn" data-act="expand">Expand</button>
              <div class="pill" data-role="indicator">Loading…</div>
              <button class="ctrl prev" aria-label="Previous (Left Arrow)" data-act="prev">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path d="M15 18l-6-6 6-6" stroke="#111827" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </button>
              <button class="ctrl next" aria-label="Next (Right Arrow)" data-act="next">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="#111827" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </button>
              <div class="pdf-wrap"><canvas class="pdf-canvas"></canvas></div>
            </div>
            <div class="text">
              <h3>Quokka Brew — Can Design Research &amp; Iterations</h3>
              <p>60+ interviews, perception testing on brand + flavors, and an iterative visual system that improved shelf recognition and informed go-to-market assets.</p>
              <div class="tags"><span class="tag">Deck</span><span class="tag">Consumer Insights</span><span class="tag">Design Research</span></div>
            </div>
          </div>
        </article>

        <!-- 2) CLEAR CLINICAL (MERGED: Mid + Final) -->
        <article class="bubble">
          <div class="bubble-grid">
            <div class="media deck"
                 data-type="pdf-merged"
                 data-title="Clear Clinical — Mid + Final Presentations"
                 data-srcs="Projects/MID%20SEMSESTER%20DELIVERABLE%20CLEAR%20CLINICAL.pdf|Projects/FINAL%20PRESENTATION%20CLEAR%20CLINICAL%20.pdf"
                 tabindex="0" aria-label="Clear Clinical merged viewer">
              <button class="expand-btn" data-act="expand">Expand</button>
              <div class="pill" data-role="indicator">Loading…</div>
              <button class="ctrl prev" aria-label="Previous (Left Arrow)" data-act="prev">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path d="M15 18l-6-6 6-6" stroke="#111827" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </button>
              <button class="ctrl next" aria-label="Next (Right Arrow)" data-act="next">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="#111827" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </button>
              <div class="pdf-wrap"><canvas class="pdf-canvas"></canvas></div>
            </div>
            <div class="text">
              <h3>Clear Clinical — Product Strategy &amp; UX</h3>
              <p>Semester-long engagement synthesizing user interviews, competitive analysis, and roadmap proposals. Viewer merges both **Mid-Semester Deliverable** and **Final Presentation** into one smooth deck.</p>
              <div class="tags"><span class="tag">Deck</span><span class="tag">Product Strategy</span><span class="tag">Research</span></div>
            </div>
          </div>
        </article>

        <!-- 3) EY Workshop (gallery) -->
        <article class="bubble">
          <div class="bubble-grid">
            <div class="media gallery"
                 data-title="EY Workshop — Design Thinking for Low-Income Students"
                 data-images="Projects/EY1.JPG|Projects/EY2.JPG|Projects/EY3.JPG|Projects/EY4.JPG"
                 tabindex="0" aria-label="EY workshop gallery">
              <button class="expand-btn" data-act="expand">Expand</button>
              <div class="pill" data-role="indicator">1 / 4</div>
              <button class="ctrl prev" aria-label="Previous (Left Arrow)" data-act="prev">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path d="M15 18l-6-6 6-6" stroke="#111827" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </button>
              <button class="ctrl next" aria-label="Next (Right Arrow)" data-act="next">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="#111827" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </button>
              <div class="gallery-wrap"><img class="gallery-img" alt="EY workshop photo"></div>
            </div>
            <div class="text">
              <h3>EY Workshop — Design Thinking</h3>
              <p>Planned and facilitated a hands-on workshop introducing design-thinking tools to low-income high-school students; focused on problem framing, rapid ideation, and prototyping.</p>
              <div class="tags"><span class="tag">Workshop</span><span class="tag">Education</span><span class="tag">Community</span></div>
            </div>
          </div>
        </article>

        <!-- 4) Partnership Advocacy Day (gallery) -->
        <article class="bubble">
          <div class="bubble-grid">
            <div class="media gallery"
                 data-title="Policy Advocacy Day — Sacramento"
                 data-images="Projects/Partnership_Advocacy_Day1.JPG|Projects/Partnership_Advocacy_Day2.JPG"
                 tabindex="0" aria-label="Partnership Advocacy gallery">
              <button class="expand-btn" data-act="expand">Expand</button>
              <div class="pill" data-role="indicator">1 / 2</div>
              <button class="ctrl prev" aria-label="Previous (Left Arrow)" data-act="prev">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path d="M15 18l-6-6 6-6" stroke="#111827" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </button>
              <button class="ctrl next" aria-label="Next (Right Arrow)" data-act="next">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="#111827" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </button>
              <div class="gallery-wrap"><img class="gallery-img" alt="Policy advocacy photo"></div>
            </div>
            <div class="text">
              <h3>Policy Advocacy Day — Sacramento</h3>
              <p>Met with California legislators to advocate for education and youth-support policies alongside community partners; coordinated talking points and constituent stories.</p>
              <div class="tags"><span class="tag">Advocacy</span><span class="tag">Policy</span><span class="tag">Community</span></div>
            </div>
          </div>
        </article>

      </div>
    </section>
  </main>

  <!-- Lightbox -->
  <div class="lb" id="lightbox" role="dialog" aria-modal="true" aria-label="Viewer">
    <div class="lb-inner">
      <div class="lb-head">
        <div class="lb-title" id="lb-title">Viewer</div>
        <button class="lb-close" id="lb-close" aria-label="Close (Esc)">Close</button>
      </div>
      <div class="lb-body" id="lb-body">
        <button class="lb-ctrl prev" id="lb-prev" aria-label="Previous (Left Arrow)">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path d="M15 18l-6-6 6-6" stroke="#111827" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <button class="lb-ctrl next" id="lb-next" aria-label="Next (Right Arrow)">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="#111827" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <div class="lb-pill" id="lb-ind">Page 1</div>
        <canvas class="lb-canvas" id="lb-canvas"></canvas>
        <img id="lb-image" style="display:none;max-width:100%;height:auto;" alt="">
      </div>
    </div>
  </div>

  <footer>
    <div class="wide">© <span id="y"></span> Jan Arroyo</div>
  </footer>

  <!-- pdf.js (CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    document.getElementById('y').textContent = new Date().getFullYear();
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    /* ---------- Helpers ---------- */
    function fitPdfToCanvas(pdf, pageNum, canvas, maxW, maxH){
      return pdf.getPage(pageNum).then(page=>{
        const v1 = page.getViewport({scale:1});
        let scale = maxH ? Math.min(maxW/v1.width, maxH/v1.height) : (maxW/v1.width);
        const vp = page.getViewport({scale});
        const dpr = window.devicePixelRatio || 1;
        canvas.width = Math.floor(vp.width * dpr);
        canvas.height = Math.floor(vp.height * dpr);
        canvas.style.width = Math.floor(vp.width) + 'px';
        canvas.style.height = Math.floor(vp.height) + 'px';
        const ctx = canvas.getContext('2d', {alpha:false});
        const transform = dpr !== 1 ? [dpr,0,0,dpr,0,0] : null;
        return page.render({canvasContext:ctx, viewport:vp, transform}).promise;
      });
    }
    function setIndicator(el, txt){ el.textContent = txt; }

    /* ---------- PDF: single file viewer ---------- */
    function wirePdfSingle(deck){
      const file = deck.dataset.src;
      const canvas = deck.querySelector('.pdf-canvas');
      const ind = deck.querySelector('[data-role="indicator"]');
      const prev = deck.querySelector('[data-act="prev"]');
      const next = deck.querySelector('[data-act="next"]');
      const expand = deck.querySelector('[data-act="expand"]');
      let pdf=null, page=1, total=1, rendering=false, hover=false;

      function update(){ setIndicator(ind, 'Page '+page+' / '+total); prev.disabled=(page<=1); next.disabled=(page>=total); }
      function render(){
        if(!pdf || rendering) return; rendering=true;
        const maxW = deck.clientWidth - 2;
        fitPdfToCanvas(pdf,page,canvas,maxW).finally(()=>{rendering=false; update();});
      }
      function go(d){ page=Math.min(total,Math.max(1,page+d)); render(); }

      deck.addEventListener('mouseenter',()=>hover=true); deck.addEventListener('mouseleave',()=>hover=false);
      deck.addEventListener('keydown',e=>{ if(e.key==='ArrowRight'){e.preventDefault();go(1)} if(e.key==='ArrowLeft'){e.preventDefault();go(-1)} });
      document.addEventListener('keydown',e=>{ if(!hover) return; if(e.key==='ArrowRight'){e.preventDefault();go(1)} if(e.key==='ArrowLeft'){e.preventDefault();go(-1)} });
      prev.addEventListener('click',()=>go(-1)); next.addEventListener('click',()=>go(1));
      expand.addEventListener('click',()=> openLBPdf(deck.dataset.title,file,page,total));

      window.addEventListener('resize',render);
      pdfjsLib.getDocument(file).promise.then(p=>{ pdf=p; total=p.numPages; render(); });
    }

    /* ---------- PDF: merged multi-file viewer (pages across files) ---------- */
    function wirePdfMerged(deck){
      const files = deck.dataset.srcs.split('|').map(s=>s.trim());
      const canvas = deck.querySelector('.pdf-canvas');
      const ind = deck.querySelector('[data-role="indicator"]');
      const prev = deck.querySelector('[data-act="prev"]');
      const next = deck.querySelector('[data-act="next"]');
      const expand = deck.querySelector('[data-act="expand"]');
      let pdfs=[], pagesPer=[], total=0, curDoc=0, curPage=1, hover=false, rendering=false;

      function absIndex(){ // 1-based absolute page index
        let idx=0; for(let i=0;i<curDoc;i++) idx+=pagesPer[i]; return idx+curPage;
      }
      function update(){ setIndicator(ind, 'Page '+absIndex()+' / '+total); prev.disabled=(absIndex()<=1); next.disabled=(absIndex()>=total); }
      function render(){
        if(!pdfs.length || rendering) return; rendering=true;
        const pdf = pdfs[curDoc];
        const maxW = deck.clientWidth - 2;
        fitPdfToCanvas(pdf,curPage,canvas,maxW).finally(()=>{rendering=false; update();});
      }
      function step(d){
        let a = absIndex()+d; a = Math.min(total,Math.max(1,a));
        // convert absolute back to (doc,page)
        let left = a; curDoc=0;
        while(left>pagesPer[curDoc]){ left-=pagesPer[curDoc]; curDoc++; }
        curPage = left; render();
      }

      deck.addEventListener('mouseenter',()=>hover=true); deck.addEventListener('mouseleave',()=>hover=false);
      deck.addEventListener('keydown',e=>{ if(e.key==='ArrowRight'){e.preventDefault();step(1)} if(e.key==='ArrowLeft'){e.preventDefault();step(-1)} });
      document.addEventListener('keydown',e=>{ if(!hover) return; if(e.key==='ArrowRight'){e.preventDefault();step(1)} if(e.key==='ArrowLeft'){e.preventDefault();step(-1)} });
      prev.addEventListener('click',()=>step(-1)); next.addEventListener('click',()=>step(1));
      expand.addEventListener('click',()=> openLBPdfMerged(deck.dataset.title, files, absIndex(), total, pagesPer));

      window.addEventListener('resize',render);
      // load all PDFs, then render
      Promise.all(files.map(f=>pdfjsLib.getDocument(f).promise)).then(arr=>{
        pdfs = arr; pagesPer = arr.map(p=>p.numPages); total = pagesPer.reduce((a,b)=>a+b,0);
        render();
      });
    }

    /* ---------- Image gallery viewer ---------- */
    function wireGallery(gal){
      const imgs = gal.dataset.images.split('|').map(s=>s.trim());
      const imgEl = gal.querySelector('.gallery-img');
      const ind = gal.querySelector('[data-role="indicator"]');
      const prev = gal.querySelector('[data-act="prev"]');
      const next = gal.querySelector('[data-act="next"]');
      const expand = gal.querySelector('[data-act="expand"]');
      let i=0, hover=false;

      function set(){ imgEl.src = imgs[i]; setIndicator(ind, (i+1)+' / '+imgs.length); prev.disabled=(i===0); next.disabled=(i===imgs.length-1); }
      function go(d){ i=Math.min(imgs.length-1, Math.max(0, i+d)); set(); }

      gal.addEventListener('mouseenter',()=>hover=true); gal.addEventListener('mouseleave',()=>hover=false);
      gal.addEventListener('keydown',e=>{ if(e.key==='ArrowRight'){e.preventDefault();go(1)} if(e.key==='ArrowLeft'){e.preventDefault();go(-1)} });
      document.addEventListener('keydown',e=>{ if(!hover) return; if(e.key==='ArrowRight'){e.preventDefault();go(1)} if(e.key==='ArrowLeft'){e.preventDefault();go(-1)} });

      prev.addEventListener('click',()=>go(-1)); next.addEventListener('click',()=>go(1));
      expand.addEventListener('click',()=> openLBImages(gal.dataset.title, imgs, i));

      set();
    }

    /* ---------- Lightbox modes ---------- */
    const LB = document.getElementById('lightbox');
    const LB_CLOSE = document.getElementById('lb-close');
    const LB_TITLE = document.getElementById('lb-title');
    const LB_IND = document.getElementById('lb-ind');
    const LB_PREV = document.getElementById('lb-prev');
    const LB_NEXT = document.getElementById('lb-next');
    const LB_CANVAS = document.getElementById('lb-canvas');
    const LB_IMG = document.getElementById('lb-image');

    let LB_MODE=null; // 'pdf-single','pdf-merged','images'
    let LB_STATE=null; // per mode

    function openLBPdf(title, file, page, total){
      LB_MODE='pdf-single'; LB_STATE={file,page,total,pdf:null};
      LB_TITLE.textContent = title || 'Viewer';
      LB_IMG.style.display='none'; LB_CANVAS.style.display='block'; LB.classList.add('open');
      pdfjsLib.getDocument(file).promise.then(p=>{LB_STATE.pdf=p; lbRenderPdf();});
    }
    function openLBPdfMerged(title, files, absIndex, total, pagesPer){
      LB_MODE='pdf-merged'; LB_STATE={files,absIndex,total,pdfs:null,pagesPer};
      LB_TITLE.textContent = title || 'Viewer';
      LB_IMG.style.display='none'; LB_CANVAS.style.display='block'; LB.classList.add('open');
      Promise.all(files.map(f=>pdfjsLib.getDocument(f).promise)).then(ps=>{LB_STATE.pdfs=ps; lbRenderPdfMerged();});
    }
    function openLBImages(title, imgs, idx){
      LB_MODE='images'; LB_STATE={imgs,idx};
      LB_TITLE.textContent = title || 'Viewer';
      LB_CANVAS.style.display='none'; LB_IMG.style.display='block'; LB.classList.add('open');
      lbRenderImages();
    }

    function lbRenderPdf(){
      const body = document.getElementById('lb-body');
      const maxW = Math.min(body.clientWidth-24, 1280);
      const maxH = Math.min(window.innerHeight*0.8, 900);
      fitPdfToCanvas(LB_STATE.pdf, LB_STATE.page, LB_CANVAS, maxW, maxH).then(()=>{
        LB_IND.textContent = 'Page ' + LB_STATE.page + ' / ' + LB_STATE.total;
        LB_PREV.disabled = (LB_STATE.page<=1);
        LB_NEXT.disabled = (LB_STATE.page>=LB_STATE.total);
      });
    }
    function lbRenderPdfMerged(){
      function convert(abs){
        let left=abs, d=0;
        while(left>LB_STATE.pagesPer[d]){ left-=LB_STATE.pagesPer[d]; d++; }
        return {doc:d, page:left};
      }
      const body = document.getElementById('lb-body');
      const maxW = Math.min(body.clientWidth-24, 1280);
      const maxH = Math.min(window.innerHeight*0.8, 900);
      const pos = convert(LB_STATE.absIndex);
      fitPdfToCanvas(LB_STATE.pdfs[pos.doc], pos.page, LB_CANVAS, maxW, maxH).then(()=>{
        LB_IND.textContent = 'Page ' + LB_STATE.absIndex + ' / ' + LB_STATE.total;
        LB_PREV.disabled = (LB_STATE.absIndex<=1);
        LB_NEXT.disabled = (LB_STATE.absIndex>=LB_STATE.total);
      });
    }
    function lbRenderImages(){
      LB_IMG.src = LB_STATE.imgs[LB_STATE.idx];
      LB_IND.textContent = (LB_STATE.idx+1) + ' / ' + LB_STATE.imgs.length;
      LB_PREV.disabled = (LB_STATE.idx===0);
      LB_NEXT.disabled = (LB_STATE.idx===LB_STATE.imgs.length-1);
    }

    function lbGo(d){
      if(LB_MODE==='pdf-single'){
        LB_STATE.page = Math.min(LB_STATE.total, Math.max(1, LB_STATE.page + d)); lbRenderPdf();
      }else if(LB_MODE==='pdf-merged'){
        LB_STATE.absIndex = Math.min(LB_STATE.total, Math.max(1, LB_STATE.absIndex + d)); lbRenderPdfMerged();
      }else if(LB_MODE==='images'){
        LB_STATE.idx = Math.min(LB_STATE.imgs.length-1, Math.max(0, LB_STATE.idx + d)); lbRenderImages();
      }
    }

    LB_PREV.addEventListener('click', ()=>lbGo(-1));
    LB_NEXT.addEventListener('click', ()=>lbGo(1));
    LB_CLOSE.addEventListener('click', ()=> LB.classList.remove('open'));
    LB.addEventListener('click', (e)=>{ if(e.target===LB) LB.classList.remove('open'); });
    window.addEventListener('resize', ()=>{ if(!LB.classList.contains('open')) return; if(LB_MODE==='pdf-single') lbRenderPdf(); if(LB_MODE==='pdf-merged') lbRenderPdfMerged(); });
    document.addEventListener('keydown', (e)=>{
      if(!LB.classList.contains('open')) return;
      if(e.key==='ArrowRight'){ e.preventDefault(); lbGo(1); }
      if(e.key==='ArrowLeft'){  e.preventDefault(); lbGo(-1); }
      if(e.key==='Escape'){     e.preventDefault(); LB.classList.remove('open'); }
    });

    /* ---------- Wire up all viewers ---------- */
    document.querySelectorAll('.media.deck[data-type="pdf-single"]').forEach(wirePdfSingle);
    document.querySelectorAll('.media.deck[data-type="pdf-merged"]').forEach(wirePdfMerged);
    document.querySelectorAll('.media.gallery').forEach(wireGallery);
  </script>
</body>
</html>
